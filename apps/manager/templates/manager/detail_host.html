{% extends 'base.html' %}
{% load static %}
{% load bootstrap3 %}
{% block single-css %}
    <link rel="stylesheet" type="text/css" href="{% static 'plugins/select2/select2.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'less/manager.less' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'plugins/xterm/xterm.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'plugins/xterm/addons/fullscreen/fullscreen.css' %}">
{% endblock %}
{% block content %}
<!--Content Header-->
<section class="content-header">
    <h1>
        <i class="fa fa-laptop" id="btn-passwd"></i>
        主机 {{ object.hostname }}
        <small><i class="fa fa-angle-double-right"></i>详细信息</small>
{#        <button class="btn btn-warning" id="btn-passwd">#}
{#            <i class="fa fa-key"></i>#}
{#        </button>#}
        <small id="show_passwd"></small>
    </h1>
    <ol class="breadcrumb">
        <i class="fa fa-truck"></i>
        <li class="active">Manager</li>
        <li><a href="/manager/group/">Group</a></li>
        <li class="active">Detail</li>
    </ol>
</section>
<!--Content Header-->
<!--Main Content-->
<section class="content container-fluid">
    <div class="row">
        <div class="col-md-7">
            <div class="box">
                <div class="box-header">
                    <h3 class="box-title"><i class="fa fa-wifi"></i>主机网络信息</h3>
                </div>
                <div class="box-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="info-box">
                                <span class="info-box-icon info-box-icon-blue"><i class="fa fa-wifi"></i></span>
                                <div class="info-box-content">
                                    <span class="info-box-text">管理IP地址</span>
                                    {% if object.manage_ip == '' %}
                                        <span class="info-box-text">无</span>
                                    {% else %}
                                        <span class="info-box-text">{{ object.manage_ip }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="info-box">
                                <span class="info-box-icon info-box-icon-red"><i class="fa fa-wifi"></i></span>
                                <div class="info-box-content">
                                    <span class="info-box-text">业务IP地址</span>
                                    <span class="info-box-text">{{ object.service_ip }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="info-box">
                                <span class="info-box-icon info-box-icon-green"><i class="fa fa-wifi"></i></span>
                                <div class="info-box-content">
                                    <span class="info-box-text">外网IP地址</span>
                                    {% if object.outer_ip == '' %}
                                        <span class="info-box-text">无</span>
                                    {% else %}
                                        <span class="info-box-text">{{ object.outer_ip }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-5">
            <div class="box">
                <div class="box-header">
                    <h3 class="box-title"><i class="fa fa-phone"></i>管理人员信息</h3>
                </div>
                <div class="box-body">
                    <table class="table table-bordered" style="word-break:break-all; word-wrap:break-all;">
                        <thead>
                        <tr>
                            <th>管理员名称</th>
                            <th>电子邮件</th>
                            <th>联系方式</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for user in manage_user %}
                            <tr>
                                <td>{{ user.get_full_name }}</td>
                                <td>{{ user.get_8531email }}</td>
                                <td>{{ user.phone }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                        <tfoot>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-4">
            <div class="row">
                <div class="col-md-12">
                    <div class="box">
                        <div class="box-header">
                            <h3 class="box-title"><i class="fa fa-server"></i>应用组列表</h3>
                        </div>
                        <div class="box-body">
                            <table class="table table-bordered" style="word-break:break-all; word-wrap:break-all;">
                                    <thead>
                                    <tr>
                                        <th>应用组名称</th>
                                        <th>应用组用途</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for group in groups %}
                                        <tr>
                                            <td>{{ group.name }}</td>
                                            <td>{{ group.info }}</td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                    <tfoot>
                                    </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="box">
                        <div class="box-header">
                            <h3 class="box-title"><i class="fa fa-cubes"></i>存储列表</h3>
                        </div>
                        <div class="box-body">
                            <table class="table table-bordered" style="word-break:break-all; word-wrap:break-all;">
                                    <thead>
                                    <tr>
                                        <th>存储路径</th>
                                        <th>存储大小</th>
                                        <th>存储用途</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                        {% for storage in storages %}
                                            <tr>
                                                <td>{{ storage.disk_path }}</td>
                                                <td>{{ storage.disk_size }}</td>
                                                <td>{{ storage.info }}</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                    <tfoot>
                                    </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <div class="row">
                <div class="col-md-12">
                    <div class="box">
                        <div class="box-header">
                            <h3 class="box-title"><i class="fa fa-cogs"></i>配置信息</h3>
                        </div>
                        <div class="box-body">
                            <div class="row">
                                <div class="col-md-4">
                                     <div class="info-box">
                                        <span class="info-box-icon info-box-icon-blue"><i class="fa fa-laptop"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">操作系统类型</span>
                                            <span class="info-box-text">{{ object.get_systemtype_display }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                     <div class="info-box">
                                        <span class="info-box-icon info-box-icon-red"><i class="fa fa-th"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">服务器位置</span>
                                            <span class="info-box-text">{{ object.server_position }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                     <div class="info-box">
                                        <span class="info-box-icon info-box-icon-green"><i class="fa fa-user"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">普通用户</span>
                                            <span class="info-box-text">{{ object.normal_user }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                     <div class="info-box">
                                        <span class="info-box-icon info-box-icon-yellow"><i class="fa fa-bullseye"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">SSH访问端口</span>
                                            <span class="info-box-text">{{ object.sshport }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                     <div class="info-box">
                                        <span class="info-box-icon info-box-icon-blue"><i class="fa fa-heart"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">CPU核心数</span>
                                            {% if object.coreness == '' %}
                                            <span class="info-box-text">无</span>
                                            {% else %}
                                            <span class="info-box-text">{{ object.coreness }}</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                     <div class="info-box">
                                        <span class="info-box-icon info-box-icon-red"><i class="fa fa-microchip"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">内存</span>
                                            {% if object.memory == '' %}
                                            <span class="info-box-text">无</span>
                                            {% else %}
                                            <span class="info-box-text">{{ object.memory }}</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                     <div class="info-box">
                                        <span class="info-box-icon info-box-icon-green"><i class="fa fa-download"></i></span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">根磁盘大小</span>
                                            {% if object.root_disk == '' %}
                                            <span class="info-box-text">无</span>
                                            {% else %}
                                            <span class="info-box-text">{{ object.root_disk }}</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
{#                                <div class="col-md-1">#}
{#                                    <button class="btn btn-app" id="flush_host">#}
{#                                        <i class="fa fa-plus"></i> 刷新主机信息#}
{#                                    </button>#}
{#                                </div>#}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="box">
                        <div class="box-header">
                            <h3 class="box-title"><i class="fa fa-life-ring"></i>应用信息</h3>
                        </div>
                        <div class="box-body">
                            <table class="table table-bordered" style="word-break:break-all; word-wrap:break-all;">
                                    <thead>
                                    <tr>
                                        <th>应用类型</th>
                                        <th>应用版本</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                        {% for softlib in softlibs %}
                                            <tr>
                                                <td>{{ softlib.get_soft_type_display }}</td>
                                                <td>{{ softlib.soft_version }}</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                    <tfoot>
                                    </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- 模态框（Modal） -->
<div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
   <div class="modal-dialog modal-lg">
      <div class="modal-content" id="box">
        <!--此部分为主体内容，将远程加载进来-->
      </div>
   </div>
</div>
<!--Main Content-->
{% endblock %}
{% block foot_js %}
<script>
        function historyBack() {
            window.history.go(-1);
        }
        $(document).ready(function () {
        })
            .on('click','#flush_host',function () {
                $.ajax({
                    mimeType: 'text/html; charset=utf-8', // ! Need set mimeType only when run from local file
                    url: '/api-execute/v1/update/host/{{ object.id }}/',
                    type: 'GET',
                    success: function(data) {
                        location.reload();
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert(errorThrown);
                    },
                    dataType: "html",
                    async: false
                });
            })
            .on('click','#btn-passwd',function () {
                $('#modal').modal({
                    show: true,
{#                    backdrop: 'static',#}
{#                    keyboard: 'true',#}
                    remote:"{% url 'manager:hostshell' object.id %}"
                });
{#                $('#modal').modal('show');#}


{#                if($('#show_passwd').html()==''){#}
{#                    $.ajax({#}
{#                        type:"GET",#}
{#                        url:"/api-manager/v1/host/{{ object.id }}/passwd/",#}
{#                        dataType:"json",#}
{#                        success:function(data){#}
{#                            var passwd = data[0].password;#}
{#                            $('#show_passwd').html(passwd);#}
{#                        },#}
{#                        error:function(data){#}
{#                        }#}
{#                    })#}
{#                }#}
{#                else{#}
{#                    $('#show_passwd').html('');#}
{#                }#}
            })
</script>
{% endblock %}